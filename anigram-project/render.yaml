databases:
  - name: anigram
    databaseName: anigram
    user: anigram

services:
  - type: web
    name: anigram
    env: python
    buildCommand: "_scripts/build.sh"
    startCommand: "gunicorn anigram.wsgi"
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: anigram
          property: connectionString
      - key: SECRET_KEY
        generateValue: true
      - key: WEB_CONCURRENCY
        value: 4
 - type: pserv
   name: pgbouncer
   env: docker
   plan: starter plus
   repo: https://github.com/render-oss/docker-pgbouncer
   envVars:
   - key: DATABASE_URL
     fromDatabase:
       name: anigram
       property: connectionString
   - key: POOL_MODE
     value: transaction
   - key: SERVER_RESET_QUERY
     value: DISCARD ALL
   - key: MAX_CLIENT_CONN
     value: 10
   - key: DEFAULT_POOL_SIZE
     value: 50